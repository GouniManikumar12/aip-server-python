{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aip.org/schemas/ledger-record.json",
  "title": "LedgerRecord",
  "description": "Canonical billing record for a serve_token. Created and finalized by the Operator.",
  "type": "object",
  "required": [
    "serve_token",
    "session_id",
    "platform_id",
    "brand_agent_id",
    "auction_id",
    "state",
    "final_unit",
    "final_charge_cents",
    "currency",
    "timestamps"
  ],
  "properties": {
    "serve_token": {
      "type": "string",
      "description": "Serve token linking all events to this ad serve",
      "example": "stk_abcxyz123"
    },
    "session_id": {
      "type": "string",
      "description": "Conversation session identifier",
      "example": "sess_001"
    },
    "platform_id": {
      "type": "string",
      "description": "Identifier of the AI platform",
      "example": "pf_openai_chat"
    },
    "brand_agent_id": {
      "type": "string",
      "description": "Winning brand agent from the auction",
      "example": "ba_451"
    },
    "auction_id": {
      "type": "string",
      "description": "Auction that produced this serve",
      "example": "auc_981"
    },
    "state": {
      "type": "string",
      "enum": ["PENDING", "EXPOSED", "CLICKED", "CONVERTED", "FINALIZED", "REFUNDED"],
      "description": "Current ledger state",
      "example": "FINALIZED"
    },
    "final_unit": {
      "type": "string",
      "enum": ["CPX", "CPC", "CPA"],
      "description": "Billing unit actually charged",
      "example": "CPA"
    },
    "final_charge_cents": {
      "type": "integer",
      "description": "Final charge amount in CENTS",
      "example": 1000
    },
    "currency": {
      "type": "string",
      "description": "Currency code",
      "example": "USD"
    },
    "timestamps": {
      "type": "object",
      "description": "Timestamps for each major event",
      "properties": {
        "auction": { "type": "string", "format": "date-time" },
        "exposure": { "type": "string", "format": "date-time" },
        "click": { "type": "string", "format": "date-time" },
        "conversion": { "type": "string", "format": "date-time" }
      }
    }
  },
  "examples": [
    {
      "serve_token": "stk_abcxyz123",
      "session_id": "sess_001",
      "platform_id": "pf_openai_chat",
      "brand_agent_id": "ba_451",
      "auction_id": "auc_981",
      "state": "FINALIZED",
      "final_unit": "CPA",
      "final_charge_cents": 1200,
      "currency": "USD",
      "timestamps": {
        "auction": "2025-11-14T18:00:00Z",
        "exposure": "2025-11-14T18:00:01Z",
        "click": "2025-11-14T18:00:05Z",
        "conversion": "2025-11-14T18:03:00Z"
      }
    }
  ]
}
