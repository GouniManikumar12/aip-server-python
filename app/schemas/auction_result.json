{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "AuctionResult",
  "description": "Result of an ad auction, returned to the platform with the winning creative",
  "type": "object",
  "required": [
    "auction_id",
    "serve_token",
    "ttl_ms"
  ],
  "properties": {
    "auction_id": {
      "type": "string",
      "description": "Unique identifier for this auction",
      "example": "auc_981"
    },
    "no_bid": {
      "type": "boolean",
      "description": "Set to true when the auction window closes without any valid bids",
      "default": false
    },
    "serve_token": {
      "type": "string",
      "description": "Token used to track events for this ad serve",
      "example": "stk_abcxyz123"
    },
    "winner": {
      "type": "object",
      "description": "Information about the winning bid",
      "required": ["brand_agent_id", "cpx_price", "billable_unit"],
      "properties": {
        "brand_agent_id": {
          "type": "string",
          "description": "ID of the winning Brand Agent",
          "example": "brand_agent_123"
        },
        "campaign_id": {
          "type": "string",
          "description": "Operator-defined campaign tracking ID",
          "example": "cmp_nimbus_launch"
        },
        "product_id": {
          "type": "string",
          "description": "Product or recommendation identifier",
          "example": "prod_nimbus_crm"
        },
        "cpx_price": {
          "type": "string",
          "pattern": "^[0-9]+$",
          "description": "Final CPX cost in cents (bid = pay).",
          "example": "5"
        },
        "cpc_price": {
          "description": "Clearing CPC cost in cents (if a click occurs).",
          "oneOf": [
            {
              "type": "string",
              "pattern": "^[0-9]+$",
              "example": "145"
            },
            { "type": "null" }
          ]
        },
        "cpa_price": {
          "description": "Clearing CPA cost in cents (if a conversion occurs).",
          "oneOf": [
            {
              "type": "string",
              "pattern": "^[0-9]+$",
              "example": "1200"
            },
            { "type": "null" }
          ]
        },
        "billable_unit": {
          "type": "string",
          "description": "Highest-value billing unit that ultimately settles for this serve.",
          "enum": ["CPX", "CPC", "CPA"],
          "example": "CPA"
        }
      },
      "additionalProperties": false
    },
    "render": {
      "type": "object",
      "description": "Creative content to display to the user",
      "properties": {
        "label": {
          "type": "string",
          "description": "Disclosure label (always '[Ad]')",
          "example": "[Ad]"
        },
        "title": {
          "type": "string",
          "description": "Ad title",
          "example": "Pipedrive CRM"
        },
        "body": {
          "type": "string",
          "description": "Ad body text",
          "example": "Built for founders."
        },
        "cta": {
          "type": "string",
          "description": "Call-to-action text",
          "example": "Try for free"
        },
        "url": {
          "type": "string",
          "description": "Click-through URL with tracking",
          "format": "uri",
          "example": "https://admesh.click/stk_abcxyz123"
        },
        "image": {
          "type": "string",
          "description": "Primary creative image URL",
          "format": "uri",
          "example": "https://cdn.example.com/creative.png"
        }
      }
    },
    "ttl_ms": {
      "type": "integer",
      "description": "Time-to-live in milliseconds for this auction result",
      "minimum": 1000,
      "maximum": 300000,
      "example": 60000
    },
    "ext": {
      "$ref": "./common.json#/definitions/extensionNamespace"
    }
  },
  "oneOf": [
    {
      "required": ["winner", "render"],
      "properties": {}
    },
    {
      "required": ["no_bid"],
      "properties": {
        "no_bid": {
          "const": true
        }
      }
    }
  ],
  "examples": [
    {
      "auction_id": "auc_981",
      "serve_token": "stk_abcxyz123",
      "winner": {
        "brand_agent_id": "brand_agent_123",
        "campaign_id": "cmp_nimbus_launch",
        "product_id": "prod_nimbus_crm",
        "cpx_price": "5",
        "cpc_price": "145",
        "cpa_price": null,
        "billable_unit": "CPC"
      },
      "render": {
        "label": "[Ad]",
        "title": "Nimbus CRM Pro",
        "body": "AI-native CRM for 5-50 person teams.",
        "cta": "Try for free",
        "url": "https://admesh.click/stk_abcxyz123",
        "image": "https://cdn.example.com/nimbus/crm.png"
      },
      "ttl_ms": 60000
    },
    {
      "auction_id": "auc_982",
      "serve_token": "stk_no_bid",
      "ttl_ms": 60000,
      "no_bid": true
    }
  ],
  "$id": "https://aip.org/schemas/auction-result.json"
}
